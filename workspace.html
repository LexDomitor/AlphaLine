<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLine | Workspace</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@300&display=swap');
        :root { --bg: #000; --ui-bg: #080808; --text-dim: #666; --accent: #fff; }
        
        html, body { 
            margin: 0; padding: 0; height: 100vh; width: 100vw; 
            background: var(--bg); color: #fff; 
            font-family: 'Inter', sans-serif; overflow: hidden;
            user-select: none; -webkit-user-select: none;
        }

        /* --- HEADER --- */
        .workspace-header {
            position: fixed; top: 0; left: 0; width: 100%; height: 65px;
            background: var(--ui-bg); border-bottom: 1px solid #222;
            display: flex; align-items: center; padding: 0 2rem; box-sizing: border-box; z-index: 2000;
        }
        .status-block { margin-left: auto; display: flex; align-items: center; gap: 40px; text-align: right; }
        .clock-block { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-dim); line-height: 1.3; }

        /* --- TIMELINE HUD --- */
        #timeline-hud {
            position: absolute; left: 50%; bottom: 80px; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 25px; z-index: 1500;
        }
        #timeline-bar {
            width: 600px; height: 40px; background: rgba(8, 8, 8, 0.95); 
            border: 2px solid var(--accent); border-radius: 4px; cursor: ew-resize;
            position: relative;
        }
        .timeline-axis {
            position: absolute; top: 50%; left: 0; width: 100%; height: 1px;
            background: rgba(255, 255, 255, 0.2); transform: translateY(-50%); pointer-events: none;
        }

        /* --- MARKERS --- */
        .year-dot { position: absolute; width: 30px; height: 30px; background: #fff; border-radius: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 20; }
        .year-line { position: absolute; width: 2px; height: 20px; background: rgba(255,255,255,0.5); top: 50%; transform: translate(-50%, -50%); z-index: 10; }
        
        .year-box {
            position: absolute; background: #000; border: 1px solid #444; padding: 4px 10px;
            font-family: 'JetBrains Mono'; font-size: 0.65rem; color: #fff; white-space: nowrap; pointer-events: none;
        }
        .box-min { right: 100%; margin-right: 20px; top: 50%; transform: translateY(-50%); }
        .box-max { left: 100%; margin-left: 20px; top: 50%; transform: translateY(-50%); }
        .box-above { bottom: 100%; margin-bottom: 20px; left: 50%; transform: translateX(-50%); }

        .temp-visible { opacity: 1 !important; }
        .blip-box { opacity: 0; transition: opacity 0.3s; }

        /* --- CONTROLS --- */
        .timeline-controls { 
            display: flex; gap: 10px; cursor: grab; padding: 10px; 
            background: rgba(255,255,255,0.03); border-radius: 4px;
        }
        .tm-btn { background: #111; border: 1px solid #333; color: #666; font-size: 0.55rem; padding: 5px 12px; cursor: pointer; }
        .tm-btn:hover { color: #fff; border-color: #fff; }

        /* --- MODAL --- */
        #year-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 3000;
        }
        .modal-box { background: #080808; border: 1px solid #333; padding: 30px; width: 300px; }
    </style>
</head>
<body>

    <header class="workspace-header" id="main-header">
        <div class="brand-block">
            <div class="back-btn" onclick="exitWorkspace()">‚Üê</div>
            <div class="nav-text"><strong>ALPHALINE</strong> <span class="title-sep">|</span> <span id="active-universe-name">...</span></div>
        </div>
        <div class="status-block">
            <div id="workspace-clock" class="clock-block"></div>
        </div>
    </header>

    <div id="year-modal">
        <div class="modal-box">
            <h3 style="font-size:0.7rem; color:#666; letter-spacing:2px; margin-bottom:20px; text-align:center;">DEFINE YEAR</h3>
            <input type="number" id="year-input" style="background:#000; border:1px solid #444; color:#fff; width:100%; padding:10px; margin-bottom:20px; text-align:center;">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="tm-btn" onclick="closeYearModal()">Cancel</button>
                <button class="tm-btn" style="color:#fff;" onclick="confirmNewYear()">Confirm</button>
            </div>
        </div>
    </div>

    <div id="timeline-hud">
        <div id="timeline-bar"></div>
        <div class="timeline-controls" id="hud-drag-handle">
            <button class="tm-btn" onclick="resetTimeline()">Reset HUD</button>
            <button class="tm-btn" onclick="openYearModal()">+ New Year</button>
        </div>
    </div>

    <script>
        // --- DATA STATE ---
        let timelineData = {
            years: [],
            viewMin: null,
            viewMax: null,
            zoomLevel: 1.0,
            displayTimer: null
        };

        // --- CLOCK & UI ---
        function updateClock() {
            const now = new Date();
            document.getElementById('workspace-clock').innerHTML = `LOS ANGELES | ${now.toLocaleTimeString().toUpperCase()}<br>${now.toLocaleDateString().toUpperCase()}`;
        }
        setInterval(updateClock, 1000); updateClock();

        // --- TIMELINE LOGIC ---
        function openYearModal() { document.getElementById('year-modal').style.display = 'flex'; }
        function closeYearModal() { document.getElementById('year-modal').style.display = 'none'; }

        function confirmNewYear() {
            const y = parseInt(document.getElementById('year-input').value);
            if (!isNaN(y) && !timelineData.years.includes(y)) {
                timelineData.years.push(y);
                timelineData.years.sort((a,b) => a-b);
                if (timelineData.years.length === 1) {
                    timelineData.viewMin = y;
                    timelineData.viewMax = y;
                } else {
                    timelineData.viewMin = timelineData.years[0];
                    timelineData.viewMax = timelineData.years[timelineData.years.length-1];
                }
                renderTimeline();
            }
            closeYearModal();
        }

        function renderTimeline() {
            const bar = document.getElementById('timeline-bar');
            bar.innerHTML = '<div class="timeline-axis"></div>';
            if (timelineData.years.length === 0) return;

            const vMin = timelineData.viewMin;
            const vMax = timelineData.viewMax;
            const vRange = vMax - vMin;

            const actualMin = Math.min(...timelineData.years);
            const actualMax = Math.max(...timelineData.years);

            timelineData.years.forEach(y => {
                if (vRange > 0 && (y < vMin || y > vMax)) return;

                const marker = document.createElement('div');
                const box = document.createElement('div');
                box.className = 'year-box';
                
                let label = y.toString();
                if (y === vMin && y > actualMin) label = "..." + label;
                if (y === vMax && y < actualMax) label = label + "...";
                box.innerText = label;

                if (vRange === 0 || (y === vMin && vRange > 0)) {
                    marker.className = 'year-dot'; marker.style.left = '0%';
                    box.classList.add('box-min');
                } else if (y === vMax) {
                    marker.className = 'year-dot'; marker.style.left = '100%';
                    box.classList.add('box-max');
                } else {
                    marker.className = 'year-line';
                    const pct = ((y - vMin) / vRange) * 100;
                    marker.style.left = pct + '%';
                    box.classList.add('box-above', 'blip-box');
                }
                
                if (timelineData.displayTimer) box.classList.add('temp-visible');
                marker.appendChild(box);
                bar.appendChild(marker);
            });
        }

        // --- ZOOM & PAN ---
        const bar = document.getElementById('timeline-bar');
        bar.addEventListener('wheel', (e) => {
            e.preventDefault();
            const years = timelineData.years;
            if (years.length < 2) return;

            const range = timelineData.viewMax - timelineData.viewMin;
            const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;
            const newRange = range * zoomFactor;
            
            // Adjust around center for now (professional zoom centers on mouse later)
            const diff = (newRange - range) / 2;
            timelineData.viewMin -= diff;
            timelineData.viewMax += diff;

            triggerTemporaryDisplay();
            renderTimeline();
        });

        function triggerTemporaryDisplay() {
            if (timelineData.displayTimer) clearTimeout(timelineData.displayTimer);
            timelineData.displayTimer = setTimeout(() => {
                timelineData.displayTimer = null;
                renderTimeline();
            }, 5000);
        }

        // --- HUD DRAGGING (Restricted to Controls) ---
        const hud = document.getElementById('timeline-hud');
        const dragHandle = document.getElementById('hud-drag-handle');
        let isHudDragging = false, startX, startY, initL, initT;

        dragHandle.addEventListener('mousedown', (e) => {
            if(e.target.tagName === 'BUTTON') return;
            isHudDragging = true;
            const r = hud.getBoundingClientRect();
            startX = e.clientX; startY = e.clientY;
            initL = r.left; initT = r.top;
            hud.style.bottom = 'auto'; hud.style.transform = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (isHudDragging) {
                hud.style.left = (initL + (e.clientX - startX)) + 'px';
                hud.style.top = (initT + (e.clientY - startY)) + 'px';
            }
        });
        document.addEventListener('mouseup', () => isHudDragging = false);

        function resetTimeline() { hud.style.left = '50%'; hud.style.top = 'auto'; hud.style.bottom = '80px'; hud.style.transform = 'translateX(-50%)'; }
    </script>
</body>
</html>
