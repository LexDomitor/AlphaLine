<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLine | Creation Plane</title>
    <style>
        :root {
            --bg-color: #0c0c0c;
            --accent: #222;
            --text: #ffffff;
            --text-dim: #555;
            --block-bg: #161616;
            --apple-gray: #1d1d1f;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            background: var(--bg-color); color: var(--text); 
            font-family: 'Inter', -apple-system, sans-serif;
            overflow: hidden; 
        }

        /* --- Loading Screen Overlay --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.8s;
        }

        .loader-content { text-align: center; width: 300px; }
        
        .loader-text { 
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; 
            color: #888; margin-bottom: 20px; font-weight: 300;
            opacity: 0; transform: translateY(10px);
            animation: fadeInMove 0.5s forwards 0.2s;
        }

        .progress-track {
            width: 100%; height: 2px; background: #1d1d1f;
            border-radius: 10px; overflow: hidden;
        }

        .progress-bar {
            width: 0%; height: 100%; background: #fff;
            transition: width 1.5s cubic-bezier(0.65, 0, 0.35, 1);
        }

        @keyframes fadeInMove {
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Workspace UI (Initial Hidden State) --- */
        .workspace-ui { 
            opacity: 0; transform: scale(0.98); 
            transition: opacity 1s ease 0.4s, transform 1s cubic-bezier(0.2, 0.8, 0.2, 1) 0.4s;
        }
        .loaded .workspace-ui { opacity: 1; transform: scale(1); }

        /* --- Rest of Styles (Header, Timeline, etc) --- */
        .top-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 3rem; border-bottom: 1px solid var(--accent);
            background: var(--bg-color); height: 70px; box-sizing: border-box;
        }
        .logo-area { font-weight: 800; letter-spacing: 2px; font-size: 1rem; }
        .plane-tag { font-weight: 300; color: #444; text-transform: uppercase; font-size: 0.75rem; margin-left: 10px; }
        .universe-display-name { font-weight: 300; text-transform: uppercase; letter-spacing: 2px; font-size: 0.85rem; }

        .timeline-wrapper { width: 100%; padding: 1.2rem 4rem; box-sizing: border-box; }
        .timeline-track { width: 100%; height: 1px; background: var(--accent); display: flex; justify-content: space-between; align-items: center; }
        .timeline-cap { width: 1px; height: 12px; background: var(--text-dim); }

        #canvas {
            width: 100vw; height: calc(100vh - 160px);
            position: relative; overflow: hidden;
            background-image: radial-gradient(#1a1a1a 0.5px, transparent 0.5px);
            background-size: 30px 30px;
        }

        .data-block {
            position: absolute; width: 260px; min-height: 80px;
            background: var(--block-bg); border: 1px solid var(--accent);
            padding: 12px; cursor: move; box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .block-textarea {
            width: 100%; background: transparent; border: none; color: #ccc;
            resize: none; outline: none; font-family: inherit; font-size: 0.85rem;
            line-height: 1.5; min-height: 60px;
        }

        .footer {
            position: fixed; bottom: 0; width: 100%; padding: 0.8rem 3rem;
            display: flex; justify-content: space-between; border-top: 1px solid var(--accent);
            font-size: 0.6rem; color: #333; background: var(--bg-color); box-sizing: border-box;
        }
        .back-link { color: #444; text-decoration: none; transition: 0.2s; }
        .back-link:hover { color: #fff; }
    </style>
</head>
<body class="loading">

    <div id="loader">
        <div class="loader-content">
            <div id="loader-msg" class="loader-text">Transporting to the world of...</div>
            <div class="progress-track">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <div class="workspace-ui">
        <nav class="top-nav">
            <div class="logo-area">
                <a href="universes.html" class="back-link">ALPHALINE</a> 
                <span class="plane-tag">| Creation Plane</span>
            </div>
            <div id="active-name" class="universe-display-name">---</div>
        </nav>

        <div class="timeline-wrapper">
            <div class="timeline-track">
                <div class="timeline-cap"></div>
                <div class="timeline-cap"></div>
            </div>
        </div>

        <div id="canvas" ondblclick="spawnBlock(event)"></div>

        <footer class="footer">
            <div>Â© 2026 ALPHALINE</div>
            <div id="timestamp">12:00 PM PST</div>
        </footer>
    </div>

    <script>
        // 1. Identification & Initialization
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const universes = JSON.parse(localStorage.getItem('alphaline_universes') || "[]");
        const activeUniverse = universes.find(u => u.id == id);

        if (!activeUniverse) {
            window.location.href = 'universes.html';
        } else {
            document.getElementById('active-name').innerText = activeUniverse.name;
            document.getElementById('loader-msg').innerText = `Transporting to the world of ${activeUniverse.name}`;
        }

        // 2. The Loading Sequence
        window.addEventListener('load', () => {
            const bar = document.getElementById('progress-bar');
            const loader = document.getElementById('loader');
            
            // Trigger bar growth
            setTimeout(() => { bar.style.width = '100%'; }, 100);

            // Fade out loader and Fade in workspace
            setTimeout(() => {
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
                document.body.classList.add('loaded');
            }, 1800); // 1.8s allows for a nice smooth bar fill
        });

        // 3. Spatial Logic (Spawn & Drag)
        function spawnBlock(e) {
            if (e.target.id !== 'canvas') return;
            const block = document.createElement('div');
            block.className = 'data-block';
            block.style.left = e.clientX - 130 + 'px';
            block.style.top = e.clientY - 160 + 'px';
            block.innerHTML = `<textarea class="block-textarea" placeholder="Enter data..."></textarea>`;
            document.getElementById('canvas').appendChild(block);
            makeDraggable(block);
            block.querySelector('textarea').focus();
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = (e) => {
                if (e.target.tagName === 'TEXTAREA') return;
                e.preventDefault();
                p3 = e.clientX; p4 = e.clientY;
                document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
                document.onmousemove = (e) => {
                    e.preventDefault();
                    p1 = p3 - e.clientX; p2 = p4 - e.clientY;
                    p3 = e.clientX; p4 = e.clientY;
                    el.style.top = (el.offsetTop - p2) + "px";
                    el.style.left = (el.offsetLeft - p1) + "px";
                };
            };
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('timestamp').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + " PST";
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
