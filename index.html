// Function to calculate PST Offset
function getPSTOffset() {
    const now = new Date();
    // Use Intl to get time specifically in PST/PDT
    const pstString = now.toLocaleString("en-US", {timeZone: "America/Los_Angeles", hour12: false});
    const pstDate = new Date(pstString);
    
    // Calculate difference in hours
    const diff = Math.round((pstDate - now) / 3600000);
    const sign = diff >= 0 ? "+" : "";
    return `PST ${sign}${diff}H`;
}

async function loadLastUpdated() {
    try {
        // Fetching from a local version file
        const response = await fetch('version.json');
        const data = await response.json();
        const bTime = new Date(data.lastUpdated);
        
        const dateOps = { month: 'long', day: 'numeric', year: 'numeric' };
        const timeOps = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true };
        
        document.getElementById('last-updated').innerHTML = `
            LAST UPDATED<br>
            ${bTime.toLocaleTimeString(undefined, timeOps)} | ${bTime.toLocaleDateString(undefined, dateOps)}
        `;
    } catch (e) {
        // Fallback if file is missing
        document.getElementById('last-updated').innerHTML = "LAST UPDATED<br>OFFLINE";
    }
}

function updateLiveClock() {
    const now = new Date();
    
    // Format Time with Seconds
    const timeOps = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true };
    const dateOps = { month: 'long', day: 'numeric', year: 'numeric' };
    
    // Get Timezone Abbreviation (e.g., GMT, EST)
    const tzName = Intl.DateTimeFormat(undefined, {timeZoneName: 'short'}).formatToParts(now)
                    .find(part => part.type === 'timeZoneName').value;
    
    const region = Intl.DateTimeFormat().resolvedOptions().timeZone.replace(/_/g, ' ');
    const pstRel = getPSTOffset();

    document.getElementById('user-info').innerHTML = `
        ${region.toUpperCase()} (${tzName}) [${pstRel}]<br>
        ${now.toLocaleTimeString(undefined, timeOps)} | ${now.toLocaleDateString(undefined, dateOps)}
    `;
}

// Initialize
loadLastUpdated();
updateLiveClock();
setInterval(updateLiveClock, 1000); // Update every second
